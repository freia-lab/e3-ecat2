#pragma once
#include <ecrt.h>

/* Generated by generate_pdo_map.py */
#define VENDOR_ID     0x0000006c
#define PRODUCT_CODE  0x0000a72c
#define SLAVE_POS     0

/* 0x1600 */
static const ec_pdo_entry_info_t RXPDO_1600_ENTRIES[] = {
    {0x2000, 0x01, 8},
    {0x2000, 0x02, 8},
    {0x2000, 0x03, 8},
    {0x2000, 0x04, 8},
    {0x2000, 0x05, 8},
    {0x2000, 0x06, 8},
    {0x2000, 0x07, 8},
    {0x2000, 0x08, 8},
    {0x2000, 0x09, 8},
    {0x2000, 0x0A, 8},
    {0x2000, 0x0B, 8},
    {0x2000, 0x0C, 8},
    {0x2000, 0x0D, 8},
    {0x2000, 0x0E, 8},
    {0x2000, 0x0F, 8},
    {0x2000, 0x10, 8},
    {0x2000, 0x11, 8},
    {0x2000, 0x12, 8},
    {0x2000, 0x13, 8},
    {0x2000, 0x14, 8},
    {0x2000, 0x15, 8},
    {0x2000, 0x16, 8},
    {0x2000, 0x17, 8},
    {0x2000, 0x18, 8},
    {0x2000, 0x19, 8},
    {0x2000, 0x1A, 8},
    {0x2000, 0x1B, 8},
    {0x2000, 0x1C, 8},
    {0x2000, 0x1D, 8},
    {0x2000, 0x1E, 8},
    {0x2000, 0x1F, 8},
    {0x2000, 0x20, 8},
    {0x2000, 0x21, 8},
    {0x2000, 0x22, 8},
    {0x2000, 0x23, 8},
    {0x2000, 0x24, 8},
    {0x2000, 0x25, 8},
    {0x2000, 0x26, 8},
    {0x2000, 0x27, 8},
    {0x2000, 0x28, 8},
    {0x2000, 0x29, 8},
    {0x2000, 0x2A, 8},
    {0x2000, 0x2B, 8},
    {0x2000, 0x2C, 8},
    {0x2000, 0x2D, 8},
    {0x2000, 0x2E, 8},
    {0x2000, 0x2F, 8},
    {0x2000, 0x30, 8},
    {0x2000, 0x31, 8},
    {0x2000, 0x32, 8},
    {0x2000, 0x33, 8},
    {0x2000, 0x34, 8},
    {0x2000, 0x35, 8},
    {0x2000, 0x36, 8},
    {0x2000, 0x37, 8},
    {0x2000, 0x38, 8},
    {0x2000, 0x39, 8},
    {0x2000, 0x3A, 8},
    {0x2000, 0x3B, 8},
    {0x2000, 0x3C, 8},
    {0x2000, 0x3D, 8},
    {0x2000, 0x3E, 8},
    {0x2000, 0x3F, 8},
    {0x2000, 0x40, 8},
    {0x2000, 0x41, 8},
    {0x2000, 0x42, 8},
    {0x2000, 0x43, 8},
    {0x2000, 0x44, 8},
    {0x2000, 0x45, 8},
    {0x2000, 0x46, 8},
    {0x2000, 0x47, 8},
    {0x2000, 0x48, 8},
    {0x2000, 0x49, 8},
    {0x2000, 0x4A, 8},
    {0x2000, 0x4B, 8},
    {0x2000, 0x4C, 8},
    {0x2000, 0x4D, 8},
    {0x2000, 0x4E, 8},
    {0x2000, 0x4F, 8},
    {0x2000, 0x50, 8},
    {0x2000, 0x51, 8},
    {0x2000, 0x52, 8},
    {0x2000, 0x53, 8},
    {0x2000, 0x54, 8},
    {0x2000, 0x55, 8},
    {0x2000, 0x56, 8},
    {0x2000, 0x57, 8},
    {0x2000, 0x58, 8},
    {0x2000, 0x59, 8},
    {0x2000, 0x5A, 8},
    {0x2000, 0x5B, 8},
    {0x2000, 0x5C, 8},
    {0x2000, 0x5D, 8},
    {0x2000, 0x5E, 8},
    {0x2000, 0x5F, 8},
    {0x2000, 0x60, 8},
    {0x2000, 0x61, 8},
    {0x2000, 0x62, 8},
    {0x2000, 0x63, 8},
    {0x2000, 0x64, 8},
    {0x2000, 0x65, 8},
    {0x2000, 0x66, 8},
    {0x2000, 0x67, 8},
    {0x2000, 0x68, 8},
    {0x2000, 0x69, 8},
    {0x2000, 0x6A, 8},
    {0x2000, 0x6B, 8},
    {0x2000, 0x6C, 8},
    {0x2000, 0x6D, 8},
    {0x2000, 0x6E, 8},
    {0x2000, 0x6F, 8},
    {0x2000, 0x70, 8},
    {0x2000, 0x71, 8},
    {0x2000, 0x72, 8},
    {0x2000, 0x73, 8},
    {0x2000, 0x74, 8},
    {0x2000, 0x75, 8},
    {0x2000, 0x76, 8},
    {0x2000, 0x77, 8},
    {0x2000, 0x78, 8},
    {0x2000, 0x79, 8},
    {0x2000, 0x7A, 8},
    {0x2000, 0x7B, 8},
    {0x2000, 0x7C, 8},
    {0x2000, 0x7D, 8},
    {0x2000, 0x7E, 8},
    {0x2000, 0x7F, 8},
    {0x2000, 0x80, 8},
    {0x2000, 0x81, 8},
    {0x2000, 0x82, 8},
    {0x2000, 0x83, 8},
    {0x2000, 0x84, 8},
    {0x2000, 0x85, 8},
    {0x2000, 0x86, 8},
    {0x2000, 0x87, 8},
    {0x2000, 0x88, 8},
    {0x2000, 0x89, 8},
    {0x2000, 0x8A, 8},
    {0x2000, 0x8B, 8},
    {0x2000, 0x8C, 8},
    {0x2000, 0x8D, 8},
    {0x2000, 0x8E, 8},
    {0x2000, 0x8F, 8},
    {0x2000, 0x90, 8},
    {0x2000, 0x91, 8},
    {0x2000, 0x92, 8},
    {0x2000, 0x93, 8},
    {0x2000, 0x94, 8},
    {0x2000, 0x95, 8},
    {0x2000, 0x96, 8},
    {0x2000, 0x97, 8},
    {0x2000, 0x98, 8},
    {0x2000, 0x99, 8},
    {0x2000, 0x9A, 8},
    {0x2000, 0x9B, 8},
    {0x2000, 0x9C, 8},
    {0x2000, 0x9D, 8},
    {0x2000, 0x9E, 8},
    {0x2000, 0x9F, 8},
    {0x2000, 0xA0, 8},
    {0x2000, 0xA1, 8},
    {0x2000, 0xA2, 8},
    {0x2000, 0xA3, 8},
    {0x2000, 0xA4, 8},
    {0x2000, 0xA5, 8},
    {0x2000, 0xA6, 8},
    {0x2000, 0xA7, 8},
    {0x2000, 0xA8, 8},
    {0x2000, 0xA9, 8},
    {0x2000, 0xAA, 8},
    {0x2000, 0xAB, 8},
    {0x2000, 0xAC, 8},
    {0x2000, 0xAD, 8},
    {0x2000, 0xAE, 8},
    {0x2000, 0xAF, 8},
    {0x2000, 0xB0, 8},
    {0x2000, 0xB1, 8},
    {0x2000, 0xB2, 8},
    {0x2000, 0xB3, 8},
    {0x2000, 0xB4, 8},
    {0x2000, 0xB5, 8},
    {0x2000, 0xB6, 8},
    {0x2000, 0xB7, 8},
    {0x2000, 0xB8, 8},
    {0x2000, 0xB9, 8},
    {0x2000, 0xBA, 8},
    {0x2000, 0xBB, 8},
    {0x2000, 0xBC, 8},
    {0x2000, 0xBD, 8},
    {0x2000, 0xBE, 8},
    {0x2000, 0xBF, 8},
    {0x2000, 0xC0, 8},
    {0x2000, 0xC1, 8},
    {0x2000, 0xC2, 8},
    {0x2000, 0xC3, 8},
    {0x2000, 0xC4, 8},
    {0x2000, 0xC5, 8},
    {0x2000, 0xC6, 8},
    {0x2000, 0xC7, 8},
    {0x2000, 0xC8, 8},
};

/* 0x1601 */
static const ec_pdo_entry_info_t RXPDO_1601_ENTRIES[] = {
    {0x2001, 0x01, 8},
    {0x2001, 0x02, 8},
    {0x2001, 0x03, 8},
    {0x2001, 0x04, 8},
    {0x2001, 0x05, 8},
    {0x2001, 0x06, 8},
    {0x2001, 0x07, 8},
    {0x2001, 0x08, 8},
    {0x2001, 0x09, 8},
    {0x2001, 0x0A, 8},
    {0x2001, 0x0B, 8},
    {0x2001, 0x0C, 8},
    {0x2001, 0x0D, 8},
    {0x2001, 0x0E, 8},
    {0x2001, 0x0F, 8},
    {0x2001, 0x10, 8},
    {0x2001, 0x11, 8},
    {0x2001, 0x12, 8},
    {0x2001, 0x13, 8},
    {0x2001, 0x14, 8},
    {0x2001, 0x15, 8},
    {0x2001, 0x16, 8},
    {0x2001, 0x17, 8},
    {0x2001, 0x18, 8},
    {0x2001, 0x19, 8},
    {0x2001, 0x1A, 8},
    {0x2001, 0x1B, 8},
    {0x2001, 0x1C, 8},
    {0x2001, 0x1D, 8},
    {0x2001, 0x1E, 8},
    {0x2001, 0x1F, 8},
    {0x2001, 0x20, 8},
    {0x2001, 0x21, 8},
    {0x2001, 0x22, 8},
    {0x2001, 0x23, 8},
    {0x2001, 0x24, 8},
    {0x2001, 0x25, 8},
    {0x2001, 0x26, 8},
    {0x2001, 0x27, 8},
    {0x2001, 0x28, 8},
    {0x2001, 0x29, 8},
    {0x2001, 0x2A, 8},
    {0x2001, 0x2B, 8},
    {0x2001, 0x2C, 8},
    {0x2001, 0x2D, 8},
    {0x2001, 0x2E, 8},
    {0x2001, 0x2F, 8},
    {0x2001, 0x30, 8},
    {0x2001, 0x31, 8},
    {0x2001, 0x32, 8},
};

/* 0x1a00 */
static const ec_pdo_entry_info_t TXPDO_1A00_ENTRIES[] = {
    {0x3000, 0x01, 8},
    {0x3000, 0x02, 8},
    {0x3000, 0x03, 8},
    {0x3000, 0x04, 8},
    {0x3000, 0x05, 8},
    {0x3000, 0x06, 8},
    {0x3000, 0x07, 8},
    {0x3000, 0x08, 8},
    {0x3000, 0x09, 8},
    {0x3000, 0x0A, 8},
    {0x3000, 0x0B, 8},
    {0x3000, 0x0C, 8},
    {0x3000, 0x0D, 8},
    {0x3000, 0x0E, 8},
    {0x3000, 0x0F, 8},
    {0x3000, 0x10, 8},
    {0x3000, 0x11, 8},
    {0x3000, 0x12, 8},
    {0x3000, 0x13, 8},
    {0x3000, 0x14, 8},
    {0x3000, 0x15, 8},
    {0x3000, 0x16, 8},
    {0x3000, 0x17, 8},
    {0x3000, 0x18, 8},
    {0x3000, 0x19, 8},
    {0x3000, 0x1A, 8},
    {0x3000, 0x1B, 8},
    {0x3000, 0x1C, 8},
    {0x3000, 0x1D, 8},
    {0x3000, 0x1E, 8},
    {0x3000, 0x1F, 8},
    {0x3000, 0x20, 8},
    {0x3000, 0x21, 8},
    {0x3000, 0x22, 8},
    {0x3000, 0x23, 8},
    {0x3000, 0x24, 8},
    {0x3000, 0x25, 8},
    {0x3000, 0x26, 8},
    {0x3000, 0x27, 8},
    {0x3000, 0x28, 8},
    {0x3000, 0x29, 8},
    {0x3000, 0x2A, 8},
    {0x3000, 0x2B, 8},
    {0x3000, 0x2C, 8},
    {0x3000, 0x2D, 8},
    {0x3000, 0x2E, 8},
    {0x3000, 0x2F, 8},
    {0x3000, 0x30, 8},
    {0x3000, 0x31, 8},
    {0x3000, 0x32, 8},
    {0x3000, 0x33, 8},
    {0x3000, 0x34, 8},
    {0x3000, 0x35, 8},
    {0x3000, 0x36, 8},
    {0x3000, 0x37, 8},
    {0x3000, 0x38, 8},
    {0x3000, 0x39, 8},
    {0x3000, 0x3A, 8},
    {0x3000, 0x3B, 8},
    {0x3000, 0x3C, 8},
    {0x3000, 0x3D, 8},
    {0x3000, 0x3E, 8},
    {0x3000, 0x3F, 8},
    {0x3000, 0x40, 8},
    {0x3000, 0x41, 8},
    {0x3000, 0x42, 8},
    {0x3000, 0x43, 8},
    {0x3000, 0x44, 8},
    {0x3000, 0x45, 8},
    {0x3000, 0x46, 8},
    {0x3000, 0x47, 8},
    {0x3000, 0x48, 8},
    {0x3000, 0x49, 8},
    {0x3000, 0x4A, 8},
    {0x3000, 0x4B, 8},
    {0x3000, 0x4C, 8},
    {0x3000, 0x4D, 8},
    {0x3000, 0x4E, 8},
    {0x3000, 0x4F, 8},
    {0x3000, 0x50, 8},
    {0x3000, 0x51, 8},
    {0x3000, 0x52, 8},
    {0x3000, 0x53, 8},
    {0x3000, 0x54, 8},
    {0x3000, 0x55, 8},
    {0x3000, 0x56, 8},
    {0x3000, 0x57, 8},
    {0x3000, 0x58, 8},
    {0x3000, 0x59, 8},
    {0x3000, 0x5A, 8},
    {0x3000, 0x5B, 8},
    {0x3000, 0x5C, 8},
    {0x3000, 0x5D, 8},
    {0x3000, 0x5E, 8},
    {0x3000, 0x5F, 8},
    {0x3000, 0x60, 8},
    {0x3000, 0x61, 8},
    {0x3000, 0x62, 8},
    {0x3000, 0x63, 8},
    {0x3000, 0x64, 8},
    {0x3000, 0x65, 8},
    {0x3000, 0x66, 8},
    {0x3000, 0x67, 8},
    {0x3000, 0x68, 8},
    {0x3000, 0x69, 8},
    {0x3000, 0x6A, 8},
    {0x3000, 0x6B, 8},
    {0x3000, 0x6C, 8},
    {0x3000, 0x6D, 8},
    {0x3000, 0x6E, 8},
    {0x3000, 0x6F, 8},
    {0x3000, 0x70, 8},
    {0x3000, 0x71, 8},
    {0x3000, 0x72, 8},
    {0x3000, 0x73, 8},
    {0x3000, 0x74, 8},
    {0x3000, 0x75, 8},
    {0x3000, 0x76, 8},
    {0x3000, 0x77, 8},
    {0x3000, 0x78, 8},
    {0x3000, 0x79, 8},
    {0x3000, 0x7A, 8},
    {0x3000, 0x7B, 8},
    {0x3000, 0x7C, 8},
    {0x3000, 0x7D, 8},
    {0x3000, 0x7E, 8},
    {0x3000, 0x7F, 8},
    {0x3000, 0x80, 8},
    {0x3000, 0x81, 8},
    {0x3000, 0x82, 8},
    {0x3000, 0x83, 8},
    {0x3000, 0x84, 8},
    {0x3000, 0x85, 8},
    {0x3000, 0x86, 8},
    {0x3000, 0x87, 8},
    {0x3000, 0x88, 8},
    {0x3000, 0x89, 8},
    {0x3000, 0x8A, 8},
    {0x3000, 0x8B, 8},
    {0x3000, 0x8C, 8},
    {0x3000, 0x8D, 8},
    {0x3000, 0x8E, 8},
    {0x3000, 0x8F, 8},
    {0x3000, 0x90, 8},
    {0x3000, 0x91, 8},
    {0x3000, 0x92, 8},
    {0x3000, 0x93, 8},
    {0x3000, 0x94, 8},
    {0x3000, 0x95, 8},
    {0x3000, 0x96, 8},
    {0x3000, 0x97, 8},
    {0x3000, 0x98, 8},
    {0x3000, 0x99, 8},
    {0x3000, 0x9A, 8},
    {0x3000, 0x9B, 8},
    {0x3000, 0x9C, 8},
    {0x3000, 0x9D, 8},
    {0x3000, 0x9E, 8},
    {0x3000, 0x9F, 8},
    {0x3000, 0xA0, 8},
    {0x3000, 0xA1, 8},
    {0x3000, 0xA2, 8},
    {0x3000, 0xA3, 8},
    {0x3000, 0xA4, 8},
    {0x3000, 0xA5, 8},
    {0x3000, 0xA6, 8},
    {0x3000, 0xA7, 8},
    {0x3000, 0xA8, 8},
    {0x3000, 0xA9, 8},
    {0x3000, 0xAA, 8},
    {0x3000, 0xAB, 8},
    {0x3000, 0xAC, 8},
    {0x3000, 0xAD, 8},
    {0x3000, 0xAE, 8},
    {0x3000, 0xAF, 8},
    {0x3000, 0xB0, 8},
    {0x3000, 0xB1, 8},
    {0x3000, 0xB2, 8},
    {0x3000, 0xB3, 8},
    {0x3000, 0xB4, 8},
    {0x3000, 0xB5, 8},
    {0x3000, 0xB6, 8},
    {0x3000, 0xB7, 8},
    {0x3000, 0xB8, 8},
    {0x3000, 0xB9, 8},
    {0x3000, 0xBA, 8},
    {0x3000, 0xBB, 8},
    {0x3000, 0xBC, 8},
    {0x3000, 0xBD, 8},
    {0x3000, 0xBE, 8},
    {0x3000, 0xBF, 8},
    {0x3000, 0xC0, 8},
    {0x3000, 0xC1, 8},
    {0x3000, 0xC2, 8},
    {0x3000, 0xC3, 8},
    {0x3000, 0xC4, 8},
    {0x3000, 0xC5, 8},
    {0x3000, 0xC6, 8},
    {0x3000, 0xC7, 8},
    {0x3000, 0xC8, 8},
};

/* 0x1a01 */
static const ec_pdo_entry_info_t TXPDO_1A01_ENTRIES[] = {
    {0x3001, 0x01, 8},
    {0x3001, 0x02, 8},
    {0x3001, 0x03, 8},
    {0x3001, 0x04, 8},
    {0x3001, 0x05, 8},
    {0x3001, 0x06, 8},
    {0x3001, 0x07, 8},
    {0x3001, 0x08, 8},
    {0x3001, 0x09, 8},
    {0x3001, 0x0A, 8},
    {0x3001, 0x0B, 8},
    {0x3001, 0x0C, 8},
    {0x3001, 0x0D, 8},
    {0x3001, 0x0E, 8},
    {0x3001, 0x0F, 8},
    {0x3001, 0x10, 8},
    {0x3001, 0x11, 8},
    {0x3001, 0x12, 8},
    {0x3001, 0x13, 8},
    {0x3001, 0x14, 8},
    {0x3001, 0x15, 8},
    {0x3001, 0x16, 8},
    {0x3001, 0x17, 8},
    {0x3001, 0x18, 8},
    {0x3001, 0x19, 8},
    {0x3001, 0x1A, 8},
    {0x3001, 0x1B, 8},
    {0x3001, 0x1C, 8},
    {0x3001, 0x1D, 8},
    {0x3001, 0x1E, 8},
    {0x3001, 0x1F, 8},
    {0x3001, 0x20, 8},
    {0x3001, 0x21, 8},
    {0x3001, 0x22, 8},
    {0x3001, 0x23, 8},
    {0x3001, 0x24, 8},
    {0x3001, 0x25, 8},
    {0x3001, 0x26, 8},
    {0x3001, 0x27, 8},
    {0x3001, 0x28, 8},
    {0x3001, 0x29, 8},
    {0x3001, 0x2A, 8},
    {0x3001, 0x2B, 8},
    {0x3001, 0x2C, 8},
    {0x3001, 0x2D, 8},
    {0x3001, 0x2E, 8},
    {0x3001, 0x2F, 8},
    {0x3001, 0x30, 8},
    {0x3001, 0x31, 8},
    {0x3001, 0x32, 8},
};

/* Counts */
#define RXPDO_1600_COUNT (int)(sizeof(RXPDO_1600_ENTRIES)/sizeof(RXPDO_1600_ENTRIES[0]))
#define RXPDO_1601_COUNT (int)(sizeof(RXPDO_1601_ENTRIES)/sizeof(RXPDO_1601_ENTRIES[0]))
#define TXPDO_1A00_COUNT (int)(sizeof(TXPDO_1A00_ENTRIES)/sizeof(TXPDO_1A00_ENTRIES[0]))
#define TXPDO_1A01_COUNT (int)(sizeof(TXPDO_1A01_ENTRIES)/sizeof(TXPDO_1A01_ENTRIES[0]))

static const ec_pdo_info_t RX_PDOS[] = {
    {0x1600, RXPDO_1600_COUNT, RXPDO_1600_ENTRIES},
    {0x1601, RXPDO_1601_COUNT, RXPDO_1601_ENTRIES},
};

static const ec_pdo_info_t TX_PDOS[] = {
    {0x1A00, TXPDO_1A00_COUNT, TXPDO_1A00_ENTRIES},
    {0x1A01, TXPDO_1A01_COUNT, TXPDO_1A01_ENTRIES},
};

static const ec_sync_info_t SLAVE_SYNC_INFO[] = {
    {0, EC_DIR_OUTPUT, 0, NULL, EC_WD_DISABLE},
    {1, EC_DIR_INPUT,  0, NULL, EC_WD_DISABLE},
    {2, EC_DIR_OUTPUT, (uint8_t)(sizeof(RX_PDOS)/sizeof(RX_PDOS[0])), RX_PDOS, EC_WD_DISABLE},
    {3, EC_DIR_INPUT,  (uint8_t)(sizeof(TX_PDOS)/sizeof(TX_PDOS[0])), TX_PDOS, EC_WD_DISABLE},
    {0xFF, 0, 0, NULL, EC_WD_DISABLE}
};

static inline int total_rx_entries(void) {
    return RXPDO_1600_COUNT + RXPDO_1601_COUNT;
}

static inline int build_entry_regs(ec_pdo_entry_reg_t **regs_out, unsigned **offs_out, int *count_out)
{
    int total = RXPDO_1600_COUNT + RXPDO_1601_COUNT + TXPDO_1A00_COUNT + TXPDO_1A01_COUNT;
    ec_pdo_entry_reg_t *regs = calloc(total + 1, sizeof(*regs));
    unsigned *offs = calloc(total, sizeof(unsigned));
    if (!regs || !offs) return -1;
    int k = 0;

    /* RX first */
    for (int p=0;p<2;p++){
        const ec_pdo_info_t *pdo = &RX_PDOS[p];
        for (int e=0;e<pdo->n_entries;e++,k++){
            regs[k].alias=0; regs[k].position=SLAVE_POS;
            regs[k].vendor_id=VENDOR_ID; regs[k].product_code=PRODUCT_CODE;
            regs[k].index=pdo->entries[e].index;
            regs[k].subindex=pdo->entries[e].subindex;
            regs[k].offset=&offs[k];
        }
    }

    /* TX next */
    for (int p=0;p<2;p++){
        const ec_pdo_info_t *pdo = &TX_PDOS[p];
        for (int e=0;e<pdo->n_entries;e++,k++){
            regs[k].alias=0; regs[k].position=SLAVE_POS;
            regs[k].vendor_id=VENDOR_ID; regs[k].product_code=PRODUCT_CODE;
            regs[k].index=pdo->entries[e].index;
            regs[k].subindex=pdo->entries[e].subindex;
            regs[k].offset=&offs[k];
        }
    }
    regs[k]=(ec_pdo_entry_reg_t){0};
    *regs_out = regs; *offs_out = offs; *count_out = total;
    return 0;
}
